<!DOCTYPE html>
<html lang="fr">

  <!-- HEAD -->

  <head>
    <meta charset="utf-8" />
    <title>Orinounours by Orinoco - Ours en pelouche</title>
    <meta
      name="description"
      content="Détail de l'ours en peluche faits à la main de qualité - Fabrication Française."
    />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <link rel="stylesheet" href="style.css" />
    <link href="https://fonts.googleapis.com/css2?family=Finger+Paint&display=swap" rel="stylesheet">
  </head>

  <!-- BODY -->
  
  <body id="bodyProduit">   
    <header id="headerProduit">
      <div class="logo">Orinounours <span>by Orinoco</span></div>
      <div class="accueil"><a href="/index.html">Accueil</a></div> 
      <div class="panier"><a href="/panier.html" target="_blank ">Panier</a> </div> <!--renvoi vers page panier-->
    </header>

    <main id="mainProduit">
      <section id="sectionPic">
        <img id="teddyImg">
      </section>

      <section id="sectionDescription">
        <h2 id="teddyName"></h2>
        <h3 id="teddyPrice"></h3>
        <p id="teddyDescription"></p>
      </section>

      <section id="sectionOptionProduit">
        <div id="optionQuantite">
          <label for="quantite">Quantité</label>
          <select
            name="quantite"
            id="quantite"
            required>
            <option value=1>1</option>
            <option value=2>2</option>
            <option value=3>3</option>
            <option value=4>4</option>
          </select>
        </div>

        <div id="optionCouleur">
          <label for="couleur">Couleur</label>
          <select
            name="couleur"
            id="couleur"
            required>
          </select>
        </div>
        <button onclick="ajouter()">Ajouter</button>
      </section>
    </main>

    <footer>
      <p>Orinounours by Orinoco - All Rights Reserved</p>
    </footer>
  
  </body>

  <!-- SCRIPT -->

  <script>

  // URL Search Param
  const queryString = window.location.search;
  const urlParams = new URLSearchParams(queryString);
  const idTeddies = urlParams.get('id')

  function fillProduct (nounourses) {

  // Create Option Element and Assign Color
    for (let option of nounourses.colors) {
      let colorSelect = document.getElementById('couleur')
      let optionColor = document.createElement('option')
      optionColor.setAttribute('class', 'optionColor')
      optionColor.text = option
      colorSelect.add(optionColor)
    } 
  // Loading Teddy Info
    let teddyImg = document.getElementById('teddyImg')
    teddyImg.setAttribute('src', nounourses.imageUrl)
    let teddyName = document.getElementById('teddyName')
    teddyName.textContent = nounourses.name
    let teddyPrice = document.getElementById('teddyPrice')
    teddyPrice.textContent = nounourses.price/100 + "€"
    let teddyDescription = document.getElementById('teddyDescription')
    teddyDescription.textContent = nounourses.description
  }
  // Fetch using ID
  async function detailTeddy() {
    await fetch ('http://localhost:3000/api/teddies/' + idTeddies)
      .then((response) => response.json())
      .then((nounours) => fillProduct(nounours))
  }
  detailTeddy()

  // création du panier 

  function ajouter (){
    let product = localStorage.getItem(idTeddies)
    product = JSON.parse(product)
    let quantite = document.getElementById('quantite')
    let couleur = document.getElementById('couleur')
    let teddyDetails = {
      quantite: Number(quantite.value), 
      couleur: couleur.value}
    if (!product){
      localStorage.setItem(idTeddies, JSON.stringify([teddyDetails]))
      alert("L'article a été ajouté au panier")    
    } else {
        for (let item of product) {
          if (item.couleur === couleur.value){
            item.quantite += teddyDetails.quantite
            localStorage.setItem(idTeddies, JSON.stringify(product))
            alert("L'article a été ajouté au panier")    
            return
          }
        }
        product.push(teddyDetails)
        localStorage.setItem(idTeddies,JSON.stringify(product))
        alert("L'article a été ajouté au panier")    
      }
  } 

  </script>
</html>